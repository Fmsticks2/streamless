{"version":3,"file":"PublicApiClient.js","sourceRoot":"","sources":["../../../src/web3/PublicApiClient.ts"],"names":[],"mappings":"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","sourcesContent":["import { IClientConfig } from '../interfaces/IClientConfig';\nimport { INodeStatus } from '../interfaces/INodeStatus';\nimport { IAddressInfo } from '../interfaces/IAddressInfo';\nimport { trySafeExecute } from '../utils/retryExecuteFunction';\nimport { JSON_RPC_REQUEST_METHOD } from '../interfaces/JsonRpcMethods';\nimport { IBlockInfo } from '../interfaces/IBlockInfo';\nimport { IEndorsement } from '../interfaces/IEndorsement';\nimport { IOperationData } from '../interfaces/IOperationData';\nimport { IClique } from '../interfaces/IClique';\nimport { IStakingAddresses } from '../interfaces/IStakingAddresses';\nimport { BaseClient } from './BaseClient';\nimport { IPublicApiClient } from '../interfaces/IPublicApiClient';\nimport { IDatastoreEntry } from '../interfaces/IDatastoreEntry';\nimport { IDatastoreEntryInput } from '../interfaces/IDatastoreEntryInput';\nimport { IGetGraphInterval } from '../interfaces/IGetGraphInterval';\nimport { IGraphInterval } from '../interfaces/IGraphInterval';\nimport { IBlockcliqueBlockBySlot } from '../interfaces/IBlockcliqueBlockBySlot';\nimport { ISlot } from '@massalabs/web3-utils';\n\n/**\n * Public API client for interacting with a Massa node.\n *\n * This class provides an interface for interacting with the public API of a Massa node.\n * It offers methods for querying various data structures used in the Massa blockchain,\n * such as blocks, endorsements, operations, and stakers.\n *\n * @module PublicApiClient\n */\nexport class PublicApiClient extends BaseClient implements IPublicApiClient {\n  /**\n   * Constructor for the {@link PublicApiClient} object.\n   *\n   * @param clientConfig - The configuration settings for this client.\n   */\n  public constructor(clientConfig: IClientConfig) {\n    super(clientConfig);\n\n    // Bind all public API methods to the current context.\n    // This ensures that the methods can be called correctly even when their context is lost.\n    // For example, when passed as a callback function.\n\n    // public api methods\n    this.getNodeStatus = this.getNodeStatus.bind(this);\n    this.getAddresses = this.getAddresses.bind(this);\n    this.getBlocks = this.getBlocks.bind(this);\n    this.getEndorsements = this.getEndorsements.bind(this);\n    this.getOperations = this.getOperations.bind(this);\n    this.getCliques = this.getCliques.bind(this);\n    this.getStakers = this.getStakers.bind(this);\n    this.getBlockcliqueBlockBySlot = this.getBlockcliqueBlockBySlot.bind(this);\n    this.getGraphInterval = this.getGraphInterval.bind(this);\n  }\n\n  /**\n   * Get graph interval.\n   *\n   * @param graphInterval - The graph interval values in ms as an IGetGraphInterval.\n   *\n   * @returns A promise which resolves in the graph interval.\n   */\n  public async getGraphInterval(\n    graphInterval: IGetGraphInterval,\n  ): Promise<Array<IGraphInterval>> {\n    const jsonRpcRequestMethod = JSON_RPC_REQUEST_METHOD.GET_GRAPH_INTERVAL;\n    if (this.clientConfig.retryStrategyOn) {\n      return await trySafeExecute<Array<IGraphInterval>>(\n        this.sendJsonRPCRequest,\n        [jsonRpcRequestMethod, [graphInterval]],\n      );\n    } else {\n      return await this.sendJsonRPCRequest<Array<IGraphInterval>>(\n        jsonRpcRequestMethod,\n        [graphInterval],\n      );\n    }\n  }\n\n  /**\n   * Get blockclique details by period and thread.\n   *\n   * @param slot - The slot as an ISlot.\n   *\n   * @returns A promise which resolves in the blockclique details.\n   */\n  public async getBlockcliqueBlockBySlot(\n    slot: ISlot,\n  ): Promise<IBlockcliqueBlockBySlot> {\n    const jsonRpcRequestMethod =\n      JSON_RPC_REQUEST_METHOD.GET_BLOCKCLIQUE_BLOCK_BY_SLOT;\n    if (this.clientConfig.retryStrategyOn) {\n      return await trySafeExecute<IBlockcliqueBlockBySlot>(\n        this.sendJsonRPCRequest,\n        [jsonRpcRequestMethod, [slot]],\n      );\n    } else {\n      return await this.sendJsonRPCRequest<IBlockcliqueBlockBySlot>(\n        jsonRpcRequestMethod,\n        [slot],\n      );\n    }\n  }\n\n  /**\n   * Retrieves the node's status.\n   *\n   * @remarks\n   * The returned information includes:\n   * - Whether the node is reachable\n   * - The number of connected peers\n   * - The node's version\n   * - The node's configuration parameters\n   *\n   * @returns A promise that resolves to the node's status information.\n   */\n  public async getNodeStatus(): Promise<INodeStatus> {\n    const jsonRpcRequestMethod = JSON_RPC_REQUEST_METHOD.GET_STATUS;\n    if (this.clientConfig.retryStrategyOn) {\n      return await trySafeExecute<INodeStatus>(this.sendJsonRPCRequest, [\n        jsonRpcRequestMethod,\n        [],\n      ]);\n    } else {\n      return await this.sendJsonRPCRequest<INodeStatus>(\n        jsonRpcRequestMethod,\n        [],\n      );\n    }\n  }\n\n  /**\n   * Retrieves data about a list of addresses, such as their balances and block creation details.\n   *\n   * @param addresses - An array of addresses to query.\n   *\n   * @returns A promise that resolves to an array of address information.\n   */\n  public async getAddresses(\n    addresses: Array<string>,\n  ): Promise<Array<IAddressInfo>> {\n    const jsonRpcRequestMethod = JSON_RPC_REQUEST_METHOD.GET_ADDRESSES;\n    if (this.clientConfig.retryStrategyOn) {\n      return await trySafeExecute<Array<IAddressInfo>>(\n        this.sendJsonRPCRequest,\n        [jsonRpcRequestMethod, [addresses]],\n      );\n    } else {\n      return await this.sendJsonRPCRequest<Array<IAddressInfo>>(\n        jsonRpcRequestMethod,\n        [addresses],\n      );\n    }\n  }\n\n  /**\n   * Show data about a block (content, finality ...).\n   *\n   * @remarks\n   * The blocks are stored in the node cache. After a certain time (depending of the network activity),\n   * the blocks are removed from the cache and the node will not be able to return the block data.\n   * The corresponding api parameter is 'max_discarded_blocks'.\n   * More information can be found here: https://docs.massa.net/en/latest/testnet/all-config.html\n   *\n   * @param blockIds - The block ids as an array of strings.\n   *\n   * @returns A promise which resolves in the block data.\n   */\n  public async getBlocks(blockIds: Array<string>): Promise<Array<IBlockInfo>> {\n    const jsonRpcRequestMethod = JSON_RPC_REQUEST_METHOD.GET_BLOCKS;\n    if (this.clientConfig.retryStrategyOn) {\n      return await trySafeExecute<Array<IBlockInfo>>(this.sendJsonRPCRequest, [\n        jsonRpcRequestMethod,\n        [blockIds],\n      ]);\n    } else {\n      return await this.sendJsonRPCRequest<Array<IBlockInfo>>(\n        jsonRpcRequestMethod,\n        [blockIds],\n      );\n    }\n  }\n\n  /**\n   * Show info about a list of endorsements.\n   *\n   * @param endorsementIds - The endorsement ids as an array of strings.\n   *\n   * @returns A promise which resolves in the endorsement data.\n   */\n  public async getEndorsements(\n    endorsementIds: Array<string>,\n  ): Promise<Array<IEndorsement>> {\n    const jsonRpcRequestMethod = JSON_RPC_REQUEST_METHOD.GET_ENDORSEMENTS;\n    if (this.clientConfig.retryStrategyOn) {\n      return await trySafeExecute<Array<IEndorsement>>(\n        this.sendJsonRPCRequest,\n        [jsonRpcRequestMethod, [endorsementIds]],\n      );\n    } else {\n      return await this.sendJsonRPCRequest<Array<IEndorsement>>(\n        jsonRpcRequestMethod,\n        [endorsementIds],\n      );\n    }\n  }\n\n  /**\n   * Retrieves data about a list of operations.\n   *\n   * @param operationIds - An array of operation IDs to query.\n   *\n   * @returns A promise that resolves to an array of operation data.\n   */\n  public async getOperations(\n    operationIds: Array<string>,\n  ): Promise<Array<IOperationData>> {\n    const jsonRpcRequestMethod = JSON_RPC_REQUEST_METHOD.GET_OPERATIONS;\n    if (this.clientConfig.retryStrategyOn) {\n      return await trySafeExecute<Array<IOperationData>>(\n        this.sendJsonRPCRequest,\n        [jsonRpcRequestMethod, [operationIds]],\n      );\n    } else {\n      return await this.sendJsonRPCRequest<Array<IOperationData>>(\n        jsonRpcRequestMethod,\n        [operationIds],\n      );\n    }\n  }\n\n  /**\n   * Get cliques.\n   *\n   * @returns A promise which resolves to the cliques.\n   */\n  public async getCliques(): Promise<Array<IClique>> {\n    const jsonRpcRequestMethod = JSON_RPC_REQUEST_METHOD.GET_CLIQUES;\n    if (this.clientConfig.retryStrategyOn) {\n      return await trySafeExecute<Array<IClique>>(this.sendJsonRPCRequest, [\n        jsonRpcRequestMethod,\n        [],\n      ]);\n    } else {\n      return await this.sendJsonRPCRequest<Array<IClique>>(\n        jsonRpcRequestMethod,\n        [],\n      );\n    }\n  }\n\n  /**\n   * Retrieves a list of active stakers and their roll counts for the current cycle.\n   *\n   * @returns A promise that resolves to an array of staking addresses and their roll counts.\n   */\n  public async getStakers(): Promise<Array<IStakingAddresses>> {\n    const jsonRpcRequestMethod = JSON_RPC_REQUEST_METHOD.GET_STAKERS;\n    if (this.clientConfig.retryStrategyOn) {\n      return await trySafeExecute<Array<IStakingAddresses>>(\n        this.sendJsonRPCRequest,\n        [jsonRpcRequestMethod, []],\n      );\n    } else {\n      return await this.sendJsonRPCRequest<Array<IStakingAddresses>>(\n        jsonRpcRequestMethod,\n        [],\n      );\n    }\n  }\n\n  /**\n   * Retrieves the data entries at both the latest final and active executed slots.\n   *\n   * @param addressesKeys - An array of objects containing address and key data.\n   *\n   * @returns A promise that resolves to an array of datastore entries.\n   *\n   * @remarks returned values could be easily converted into string if needed using e.g.: bytesToStr(scStorageValue[0].final_value)\n   */\n  public async getDatastoreEntries(\n    addressesKeys: Array<IDatastoreEntryInput>,\n  ): Promise<Array<IDatastoreEntry>> {\n    const data = [];\n    for (const input of addressesKeys) {\n      data.push({\n        address: input.address,\n        key: Array.prototype.slice.call(Buffer.from(input.key)),\n      });\n    }\n    const jsonRpcRequestMethod = JSON_RPC_REQUEST_METHOD.GET_DATASTORE_ENTRIES;\n    let datastoreEntries: Array<IDatastoreEntry> = [];\n    if (this.clientConfig.retryStrategyOn) {\n      datastoreEntries = await trySafeExecute<Array<IDatastoreEntry>>(\n        this.sendJsonRPCRequest,\n        [jsonRpcRequestMethod, [data]],\n      );\n    } else {\n      datastoreEntries = await this.sendJsonRPCRequest<Array<IDatastoreEntry>>(\n        jsonRpcRequestMethod,\n        [data],\n      );\n    }\n    return datastoreEntries.map((e) => {\n      return {\n        final_value: new Uint8Array(e.final_value),\n        candidate_value: new Uint8Array(e.candidate_value),\n      };\n    });\n  }\n}\n"]}