{"version":3,"file":"ClientFactory.js","sourceRoot":"","sources":["../../../src/web3/ClientFactory.ts"],"names":[],"mappings":"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","sourcesContent":["import { IProvider, ProviderType } from '../interfaces/IProvider';\nimport { IAccount } from '../interfaces/IAccount';\nimport { Client } from './Client';\nimport { IClientConfig } from '../interfaces/IClientConfig';\nimport {\n  IAccount as IAccountWalletProvider,\n  IProvider as IProviderWalletProvider,\n} from '@massalabs/wallet-provider';\nimport { Web3Account } from './accounts/Web3Account';\nimport { PublicApiClient } from './PublicApiClient';\nimport { WalletProviderAccount } from './accounts/WalletProviderAccount';\n\n/** Global connection urls, for Massa's MAINNET, TESTNET, LABNET, LOCALNET and BUILDNET */\nexport enum DefaultProviderUrls {\n  MAINNET = 'https://massa.net/api/v2',\n  TESTNET = 'https://test.massa.net/api/v2',\n  BUILDNET = 'https://buildnet.massa.net/api/v2',\n  LABNET = 'https://labnet.massa.net/api/v2',\n  LOCALNET = 'http://127.0.0.1',\n}\n\n/**\n * Massa Web3 ClientFactory class allows you to easily initialize a client to\n * connect to the massa blockchain.\n *\n * @remarks\n * The client can be initialized using a default provider (MAINNET, TESTNET, LABNET, LOCALNET and BUILDNET)\n * or a custom set of providers.\n */\nexport class ClientFactory {\n  /**\n   * Creates a default client using a default provider (MAINNET, TESTNET, LABNET, LOCALNET and BUILDNET).\n   *\n   * @param provider - Default provider to be used by the client.\n   * @param chainId - Chain id matching the network used by the provider\n   * @param retryStrategyOn - Whether to retry failed requests.\n   * @param baseAccount - Base account to use with the client (optional).\n   *\n   * @returns A promise that resolves to a Client object.\n   */\n  public static async createDefaultClient(\n    provider: DefaultProviderUrls,\n    chainId: bigint,\n    retryStrategyOn = true,\n    baseAccount?: IAccount,\n  ): Promise<Client> {\n    let publicProviderUrl = provider.toString();\n    let privateProviderUrl = provider.toString();\n    switch (provider) {\n      // in the case of LocalNet append specific default ports to url.\n      case DefaultProviderUrls.LOCALNET: {\n        privateProviderUrl = `${privateProviderUrl}:33034`;\n        publicProviderUrl = `${publicProviderUrl}:33035`;\n        break;\n      }\n      // all other networks should have public access only.\n      default: {\n        break;\n      }\n    }\n\n    const providers = [\n      {\n        url: publicProviderUrl,\n        type: ProviderType.PUBLIC,\n      } as IProvider,\n      {\n        url: privateProviderUrl,\n        type: ProviderType.PRIVATE,\n      } as IProvider,\n    ];\n\n    let clientConfig = {\n      retryStrategyOn,\n      providers,\n    } as IClientConfig;\n    let publicApi = new PublicApiClient(clientConfig);\n    let account: Web3Account = null;\n    if (baseAccount) {\n      account = new Web3Account(baseAccount, publicApi, chainId);\n    }\n    const client: Client = new Client(\n      {\n        retryStrategyOn,\n        providers,\n      } as IClientConfig,\n      account,\n      publicApi,\n    );\n    return client;\n  }\n\n  /**\n   * Initializes a new client using a custom set of private and public providers.\n   *\n   * @remarks\n   * Suitable for local node interactions.\n   *\n   * @param providers - Array of providers to be used by the client.\n   * @param chainId - Chain id matching the network used by the provider\n   * @param retryStrategyOn - Whether to retry failed requests.\n   * @param baseAccount - Base account to be used by the client (optional).\n   *\n   * @returns A promise that resolves to a Client object.\n   */\n  public static async createCustomClient(\n    providers: Array<IProvider>,\n    chainId: bigint,\n    retryStrategyOn = true,\n    baseAccount?: IAccount,\n  ): Promise<Client> {\n    let clientConfig = {\n      retryStrategyOn,\n      providers,\n    } as IClientConfig;\n    let publicApi = new PublicApiClient(clientConfig);\n    let account: Web3Account = null;\n    if (baseAccount) {\n      account = new Web3Account(baseAccount, publicApi, chainId);\n    }\n    const client: Client = new Client(clientConfig, account, publicApi);\n    return client;\n  }\n\n  /**\n   * Initializes a new client using the wallet provider.\n   *\n   * @remarks\n   * Suitable for local node interactions.\n   *\n   * @param provider - Provider from wallet provider to be used by the client.\n   * @param baseAccount - Base account from the wallet provider to be used by the client.\n   * @param retryStrategyOn - Whether to retry failed requests.\n   *\n   * @returns A promise that resolves to a Client object.\n   */\n  public static async fromWalletProvider(\n    provider: IProviderWalletProvider,\n    baseAccount: IAccountWalletProvider,\n    retryStrategyOn = true,\n  ): Promise<Client> {\n    const providers = (await provider.getNodesUrls()).map((url) => {\n      return {\n        url,\n        type: ProviderType.PUBLIC,\n      };\n    });\n    const client: Client = new Client(\n      {\n        retryStrategyOn,\n        providers,\n      },\n      new WalletProviderAccount(baseAccount),\n    );\n\n    return client;\n  }\n}\n"]}